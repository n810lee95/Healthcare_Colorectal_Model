import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
from sklearn.model_selection import train_test_split
from sklearn.tree import DecisionTreeClassifier
from sklearn.preprocessing import LabelEncoder
from sklearn.preprocessing import StandardScaler
from sklearn.metrics import accuracy_score, classification_report


# convert data to a pandas Dataframe
# df = pd.read_csv(colorectal_cancer_dataset.csv)

# Check data types in Dataframe
print(df.info())

# Remove duplicates
df = df.drop_duplicates()

# Update Boolean columns to 1 and 0

bool_cols = df.select_dtypes(include=['bool']).columns
df[bool_cols] = df[bool_cols].astype(int)

# Select object columns
obj_cols = df.select_dtypes(include=['object']).columns

# Loop through columns and transform
for col in obj_cols:
    df[col] = le.fit_transform(df[col])

# Instantiate Standard Scaler to center the numeric features around zero

scaler = StandardScaler()

# Use scaler on remaining numeric columns
df[['Age']] = scaler.fit_transform(df[['Age']])
df[['Tumor_Size_mm']] = scaler.fit_transform(df[['Tumor_Size_mm']])
df[['Healthcare_Costs']] = scaler.fit_transform(df[['Healthcare_Costs']])
df[['Incidence_Rate_per_100K']] = scaler.fit_transform(df[['Incidence_Rate_per_100K']])
df[['Mortality_Rate_per_100K']] = scaler.fit_transform(df[['Mortality_Rate_per_100K']])


# Select features and target
X = df.drop(columns=['Survival_Prediction','Survival_5_years','Mortality', 'Patient_ID'])  # Drop ID column
y = df['Mortality']


# Split into test and training sets 
X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=31)


# Instantiate Decision Tree Classifier Model
dt_model = DecisionTreeClassifier(max_depth=10, random_state=31)
dt_model.fit(X_train, y_train)

# Predict and evaluate
y_pred = dt_model.predict(X_test)
y_pred_t = dt_model.predict(X_train)
# assign result classification report to variable
report_dict = classification_report(y_test, y_pred, output_dict=True)

# Assign precision, recall, and f1 scores to variables
dtc_precision = report_dict['0']['precision']
dtc_recall = report_dict['0']['recall']
dtc_f1 = report_dict['0']['f1-score']

# print results
print(f"Decision Tree Classifer Accuracy: {accuracy_score(y_test, y_pred):.3f}")
print("Decision Tree Classification Report")
print(classification_report(y_test, y_pred))
print(f"Precision: {dtc_precision}")
print(f"Recall: {dtc_recall}")
print(f"F1 Score: {dtc_f1}")

# Review feature importances and plot with matplot
feature_imp = pd.Series(dt_model.feature_importances_, index=X_train.columns).sort_values(ascending=False)
feature_imp.nlargest(10).plot(kind='barh')
plt.title("Decision Tree Feature Importance")
plt.xlabel("Importance Score")
plt.show()
